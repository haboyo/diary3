<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA & iOS Home Screen Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Bong's Diary">
    
    <link rel="apple-touch-icon" href="https://github.com/haboyo/diary3/blob/main/diary.jpg?raw=true&v=final">
    <link rel="icon" type="image/jpeg" href="https://github.com/haboyo/diary3/blob/main/diary.jpg?raw=true&v=final">

    <title>Bong's Diary</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Inter:wght@300;400;600;800&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        :root {
            --bg-main: #FDFCF8;
            --text-main: #1A1A1A;
            --soft-gray: #F1F0EB;
            --weekend-sun: #E15B5B;
            --weekend-sat: #5B82E1;
            --share-yellow: #FEE500;
        }

        html, body {
            position: fixed;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
        }

        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            -webkit-tap-highlight-color: transparent;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding-top: env(safe-area-inset-top);
        }

        header { flex-shrink: 0; background: var(--bg-main); z-index: 10; }
        main { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 20px; scroll-behavior: smooth; }
        
        nav { 
            flex-shrink: 0; 
            padding-bottom: calc(env(safe-area-inset-bottom) + 12px); 
            padding-top: 12px;
            background: rgba(253, 252, 248, 0.95); 
            backdrop-filter: blur(10px); 
            border-top: 1px solid #F1F0EB; 
        }

        .cursive-title { font-family: 'Dancing Script', cursive; font-size: 1.7rem; color: var(--text-main); opacity: 0.9; }
        
        .week-slider-container { display: flex; align-items: center; gap: 8px; }
        .week-days-scroll { display: flex; flex: 1; justify-content: space-between; overflow-x: hidden; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .btn-press:active { transform: scale(0.96); transition: transform 0.1s; }
        textarea:focus, input:focus { outline: none; }
        
        .journal-textarea { 
            font-size: 15px !important; 
            line-height: 1.4 !important; 
            width: 100%; 
            height: 100%; 
            min-height: 250px; 
        }

        .memo-content {
            line-height: 1.4 !important;
        }

        .line-clamp-2-custom {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .memo-card-highlighted {
            border-color: #3b82f6 !important;
            border-width: 2px !important;
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1);
            transform: scale(1.01);
            z-index: 5;
        }

        .memo-textarea-expandable {
            transition: min-height 0.2s ease-in-out;
            overflow-y: hidden;
        }
        
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

        .calendar-dot { width: 4px; height: 4px; background-color: var(--text-main); border-radius: 50%; margin-top: 2px; opacity: 0.3; }
        .text-sun { color: var(--weekend-sun) !important; }
        .text-sat { color: var(--weekend-sat) !important; }

        .calendar-month-title { font-size: 2.5rem; font-weight: 900; letter-spacing: -0.05em; }

        .btn-share { background-color: var(--share-yellow); color: #3C1E1E; font-weight: 800; font-size: 11px; padding: 6px 14px; border-radius: 8px; display: flex; align-items: center; gap: 6px; }
        .btn-copy { background-color: #F1F0EB; color: #1A1A1A; padding: 6px 10px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }

        .tag-chip {
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            background: white;
            border: 1px solid #E5E7EB;
            white-space: nowrap;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root" style="width: 100%; height: 100%;"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const KOREAN_HOLIDAYS = {
            "2025": {"01-01":"신정","01-28":"설날","01-27":"설날연휴","01-29":"설날연휴","01-30":"대체공휴일","03-01":"삼일절","03-03":"대체공휴일","05-05":"어린이날","05-06":"대체공휴일","06-06":"현충일","08-15":"광복절","10-03":"개천절","10-06":"추석","10-05":"추석연휴","10-07":"추석연휴","10-08":"대체공휴일","10-09":"한글날","12-25":"성탄절"},
            "2026": {"01-01":"신정","02-17":"설날","02-16":"설날연휴","02-18":"설날연휴","03-01":"삼일절","03-02":"대체공휴일","05-05":"어린이날","05-24":"석가탄신일","05-25":"대체공휴일","06-06":"현충일","08-15":"광복절","08-17":"대체공휴일","09-25":"추석","09-24":"추석연휴","09-26":"추석연휴","10-03":"개천절","10-05":"대체공휴일","10-09":"한글날","12-25":"성탄절"}
        };

        const STORAGE_KEY = 'bong_diary_pro_v3';
        const APP_VERSION = 'v3.5.9';
        const APP_NAME = "Bong's Diary";

        const App = () => {
            const [activeTab, setActiveTab] = useState('Journal');
            const [currentDate, setCurrentDate] = useState(new Date());
            const [viewMonth, setViewMonth] = useState(new Date());
            const [showCalendar, setShowCalendar] = useState(false);
            const [message, setMessage] = useState('');
            
            const [expandedMemoIds, setExpandedMemoIds] = useState(new Set());
            const [highlightedMemoId, setHighlightedMemoId] = useState(null);
            
            const [weekAnchor, setWeekAnchor] = useState(() => {
                const d = new Date();
                d.setDate(d.getDate() - d.getDay());
                return d;
            });
            
            const fileInputRef = useRef(null);
            const memoTextareaRef = useRef(null);
            const mainScrollRef = useRef(null);
            
            const [journals, setJournals] = useState(() => JSON.parse(localStorage.getItem(`${STORAGE_KEY}_journals`) || '{}'));
            const [memos, setMemos] = useState(() => JSON.parse(localStorage.getItem(`${STORAGE_KEY}_memos`) || '[]'));
            const [todos, setTodos] = useState(() => JSON.parse(localStorage.getItem(`${STORAGE_KEY}_todos`) || '[]'));

            const [newTodo, setNewTodo] = useState('');
            const [newMemo, setNewMemo] = useState({ content: '', tag: '', id: null });
            const [searchQuery, setSearchQuery] = useState('');

            useEffect(() => {
                localStorage.setItem(`${STORAGE_KEY}_journals`, JSON.stringify(journals));
                localStorage.setItem(`${STORAGE_KEY}_memos`, JSON.stringify(memos));
                localStorage.setItem(`${STORAGE_KEY}_todos`, JSON.stringify(todos));
            }, [journals, memos, todos]);

            useEffect(() => {
                if (memoTextareaRef.current && activeTab === 'Memo') {
                    memoTextareaRef.current.style.height = 'auto';
                    const scrollHeight = memoTextareaRef.current.scrollHeight;
                    memoTextareaRef.current.style.height = `${Math.max(60, scrollHeight)}px`;
                }
            }, [newMemo.content, activeTab]);

            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });

            useEffect(() => {
                const d = new Date(currentDate);
                d.setDate(d.getDate() - d.getDay());
                setWeekAnchor(d);
            }, [currentDate]);

            useEffect(() => {
                if (activeTab === 'Memo' && highlightedMemoId) {
                    setTimeout(() => {
                        const element = document.getElementById(`memo-${highlightedMemoId}`);
                        if (element && mainScrollRef.current) {
                            const rect = element.getBoundingClientRect();
                            const scrollPos = element.offsetTop - (mainScrollRef.current.clientHeight / 2) + (rect.height / 2);
                            mainScrollRef.current.scrollTo({ top: scrollPos, behavior: 'smooth' });
                        }
                    }, 300);
                }
            }, [activeTab, highlightedMemoId]);

            const existingTags = useMemo(() => {
                const tags = memos.map(m => m.tag).filter(t => t && t.trim() !== '');
                return [...new Set(tags)].sort();
            }, [memos]);

            const groupedMemos = useMemo(() => {
                const groups = {};
                const noTag = [];
                memos.forEach(memo => {
                    if (memo.tag && memo.tag.trim() !== '') {
                        if (!groups[memo.tag]) groups[memo.tag] = [];
                        groups[memo.tag].push(memo);
                    } else {
                        noTag.push(memo);
                    }
                });
                return { groups, noTag };
            }, [memos]);

            const showToast = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(''), 2000);
            };

            const getHolidayName = (date) => {
                const y = date.getFullYear().toString();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return KOREAN_HOLIDAYS[y]?.[`${m}-${d}`] || null;
            };

            const moveWeek = (offset) => {
                const newAnchor = new Date(weekAnchor);
                newAnchor.setDate(weekAnchor.getDate() + (offset * 7));
                setWeekAnchor(newAnchor);
                const newCurrent = new Date(currentDate);
                newCurrent.setDate(currentDate.getDate() + (offset * 7));
                setCurrentDate(newCurrent);
            };

            const filteredResults = () => {
                if (!searchQuery.trim()) return [];
                const res = [];
                Object.entries(journals).forEach(([dateStr, content]) => {
                    if (content.includes(searchQuery)) res.push({ type: 'Journal', date: dateStr, text: content });
                });
                memos.forEach(m => {
                    if (m.content.includes(searchQuery) || (m.tag && m.tag.includes(searchQuery))) {
                        res.push({ type: 'Memo', id: m.id, date: m.date, text: m.content, tag: m.tag });
                    }
                });
                todos.forEach(t => {
                    if (t.text.includes(searchQuery)) res.push({ type: 'Todo', id: t.id, text: t.text });
                });
                return res;
            };

            const getFormattedShareText = () => {
                const rawContent = journals[currentDate.toDateString()];
                if (!rawContent) return null;
                const mm = String(currentDate.getMonth() + 1).padStart(2, '0');
                const dd = String(currentDate.getDate()).padStart(2, '0');
                return `${mm}/${dd}\n\n${rawContent}`;
            };

            const handleShare = () => {
                const shareText = getFormattedShareText();
                if (!shareText) return showToast('공유할 내용이 없습니다');
                if (navigator.share) {
                    navigator.share({ title: APP_NAME, text: shareText }).catch(() => {});
                } else {
                    copyToClipboard(shareText);
                }
            };

            const copyToClipboard = (text) => {
                const tempInput = document.createElement("textarea");
                tempInput.value = text;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand("copy");
                    showToast('복사됨');
                } catch (err) {
                    showToast('복사 실패');
                }
                document.body.removeChild(tempInput);
            };

            const handleExport = (isAuto = false) => {
                const data = { journals, memos, todos, exportedAt: new Date().toISOString() };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const timestamp = isAuto ? 'auto_backup' : 'manual_backup';
                a.download = `bongs_diary_${timestamp}.json`;
                a.click();
                if (!isAuto) showToast('백업 완료');
            };

            const handleImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.journals) setJournals(data.journals);
                        if (data.memos) setMemos(data.memos);
                        if (data.todos) setTodos(data.todos);
                        showToast('데이터 복원 성공');
                    } catch (err) { showToast('파일 형식 오류'); }
                };
                reader.readAsText(file);
                e.target.value = null;
            };

            const saveMemo = () => {
                if(!newMemo.content.trim()) return;
                if (newMemo.id) {
                    setMemos(memos.map(m => m.id === newMemo.id ? { ...m, content: newMemo.content, tag: newMemo.tag } : m));
                    showToast('메모 수정됨');
                } else {
                    setMemos([{id:Date.now(), content:newMemo.content, tag:newMemo.tag, date:new Date().toLocaleDateString()}, ...memos]);
                    showToast('메모 추가됨');
                }
                setNewMemo({content:'', tag:'', id: null});
            };

            const startEditMemo = (e, memo) => {
                e.stopPropagation();
                setNewMemo({ content: memo.content, tag: memo.tag || '', id: memo.id });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleMemoSelect = (memoId) => {
                setHighlightedMemoId(prevId => prevId === memoId ? null : memoId);
                setExpandedMemoIds(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(memoId)) {
                        newSet.delete(memoId);
                    } else {
                        newSet.add(memoId);
                    }
                    return newSet;
                });
            };

            const MemoCard = ({ m }) => {
                const isExpanded = expandedMemoIds.has(m.id);
                const isHighlighted = highlightedMemoId === m.id;
                
                return (
                    <div 
                        id={`memo-${m.id}`}
                        onClick={() => handleMemoSelect(m.id)}
                        className={`bg-white p-5 rounded-2xl border transition-all duration-300 cursor-pointer ${isHighlighted ? 'memo-card-highlighted' : 'border-black/5'}`}
                    >
                        <p className={`text-[14px] opacity-80 whitespace-pre-wrap memo-content transition-all ${!isExpanded ? 'line-clamp-2-custom' : ''}`}>
                            {m.content}
                        </p>
                        <div className="flex justify-between items-center mt-4 pt-2 border-t border-slate-50">
                            <div className="flex items-center gap-3">
                                <span className="text-[8px] font-black opacity-20">{m.date}</span>
                                <button onClick={(e) => { e.stopPropagation(); copyToClipboard(m.content); }} className="text-[#1A1A1A] opacity-20 btn-press">
                                    <i data-lucide="copy" className="w-3.5 h-3.5"></i>
                                </button>
                                <button onClick={(e) => startEditMemo(e, m)} className="text-[#1A1A1A] opacity-20 btn-press">
                                    <i data-lucide="edit-3" className="w-3.5 h-3.5"></i>
                                </button>
                            </div>
                            <button onClick={(e)=>{ e.stopPropagation(); setMemos(memos.filter(item=>item.id!==m.id)); }} className="text-red-400 opacity-20"><i data-lucide="trash-2" className="w-3.5 h-3.5"></i></button>
                        </div>
                    </div>
                );
            };

            const handleTabChange = (tabId) => {
                if (tabId === 'Search') {
                    setExpandedMemoIds(new Set());
                    setHighlightedMemoId(null);
                }
                setActiveTab(tabId);
                if (tabId !== 'Search') setSearchQuery('');
            };

            return (
                <div className="app-container">
                    {message && (
                        <div className="fixed top-12 left-1/2 -translate-x-1/2 z-[2000] bg-[#1A1A1A] text-white px-5 py-2 rounded-full text-[11px] font-bold shadow-2xl fade-in text-center">
                            {message}
                        </div>
                    )}

                    <header className="px-5 pt-5 pb-2">
                        <div className="flex justify-between items-start mb-6">
                            <div className="flex-1">
                                <div className="cursive-title mb-2">{APP_NAME}</div>
                                <div className="flex items-center gap-2 mt-4 h-10">
                                    <button onClick={() => { setViewMonth(new Date(currentDate)); setShowCalendar(true); }} className="text-2xl font-black tracking-tighter flex items-center gap-1.5 btn-press">
                                        {currentDate.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })}
                                        <i data-lucide="calendar" className="w-5 h-5 opacity-20"></i>
                                    </button>
                                    {getHolidayName(currentDate) && (
                                        <div className="px-2 py-0.5 bg-red-50 text-[10px] font-bold text-sun rounded border border-red-100">
                                            {getHolidayName(currentDate)}
                                        </div>
                                    )}
                                </div>
                            </div>
                            <button onClick={() => {
                                const today = new Date();
                                setCurrentDate(today);
                            }} className="mt-2 text-[10px] font-black tracking-widest opacity-40 uppercase border-b border-black/10 btn-press">Today</button>
                        </div>

                        {activeTab === 'Journal' && (
                            <div className="week-slider-container px-0.5 pb-2">
                                <button onClick={() => moveWeek(-1)} className="p-1.5 opacity-20 btn-press"><i data-lucide="chevron-left" className="w-4 h-4"></i></button>
                                <div className="week-days-scroll">
                                    {Array.from({ length: 7 }, (_, i) => {
                                        const d = new Date(weekAnchor);
                                        d.setDate(weekAnchor.getDate() + i);
                                        const isSelected = d.toDateString() === currentDate.toDateString();
                                        const hDay = getHolidayName(d);
                                        const isSun = d.getDay() === 0 || hDay;
                                        const isSat = d.getDay() === 6;
                                        return (
                                            <button key={i} onClick={() => setCurrentDate(d)} className="flex flex-col items-center flex-1">
                                                <span className={`text-[10px] font-black mb-2.5 ${isSelected ? 'opacity-100' : 'opacity-25'} ${isSun?'text-sun':isSat?'text-sat':''}`}>{['SUN','MON','TUE','WED','THU','FRI','SAT'][d.getDay()]}</span>
                                                <span className={`text-[13px] w-8 h-8 flex items-center justify-center rounded-full transition-all ${isSelected ? 'bg-[#1A1A1A] text-white font-bold' : isSun ? 'text-sun opacity-60' : 'text-slate-400'}`}>{d.getDate()}</span>
                                            </button>
                                        );
                                    })}
                                </div>
                                <button onClick={() => moveWeek(1)} className="p-1.5 opacity-20 btn-press"><i data-lucide="chevron-right" className="w-4 h-4"></i></button>
                            </div>
                        )}
                    </header>

                    <main ref={mainScrollRef} className="no-scrollbar px-5">
                        {activeTab === 'Journal' && (
                            <div className="h-full flex flex-col fade-in pt-1">
                                <div className="flex justify-between items-center mb-4">
                                    <span className="text-[10px] font-black tracking-widest uppercase opacity-30">Record</span>
                                    <div className="flex items-center gap-2">
                                        <button onClick={() => {
                                            const formattedText = getFormattedShareText();
                                            if(!formattedText) return showToast('내용이 없습니다');
                                            copyToClipboard(formattedText);
                                        }} className="btn-copy btn-press">
                                            <i data-lucide="copy" className="w-4 h-4"></i>
                                        </button>
                                        <button onClick={handleShare} className="btn-share btn-press">
                                            <i data-lucide="message-circle" className="w-3.5 h-3.5"></i>
                                            Share
                                        </button>
                                    </div>
                                </div>
                                <textarea className="flex-1 bg-transparent border-none resize-none journal-textarea placeholder:opacity-10" placeholder="오늘은 어떤일이 있었나요?" value={journals[currentDate.toDateString()] || ''} onChange={(e) => setJournals({...journals, [currentDate.toDateString()]: e.target.value})} />
                            </div>
                        )}

                        {activeTab === 'Todo' && (
                            <div className="fade-in space-y-3 pt-3">
                                <div className="flex items-center gap-2 bg-[#F1F0EB] rounded-xl px-4 py-2">
                                    <input className="flex-1 bg-transparent text-[14px]" placeholder="할 일 추가" value={newTodo} onChange={e => setNewTodo(e.target.value)} onKeyDown={e => e.key === 'Enter' && (()=>{if(!newTodo)return;setTodos([{id:Date.now(),text:newTodo,done:false},...todos]);setNewTodo('')})()} />
                                    <button onClick={()=>{if(!newTodo)return;setTodos([{id:Date.now(),text:newTodo,done:false},...todos]);setNewTodo('')}} className="bg-[#1A1A1A] text-white p-1.5 rounded-lg"><i data-lucide="plus" className="w-3.5 h-3.5"></i></button>
                                </div>
                                {todos.map(t => (
                                    <div key={t.id} className="flex items-center gap-3 bg-white p-4 rounded-2xl border border-black/5">
                                        <button onClick={() => setTodos(todos.map(item => item.id === t.id ? {...item, done: !item.done} : item))} className={`w-5 h-5 rounded-md border-2 ${t.done ? 'bg-green-500 border-green-500' : 'border-slate-300'}`}>
                                            {t.done && <i data-lucide="check" className="w-3 h-3 text-white m-auto"></i>}
                                        </button>
                                        <span className={`text-[14px] flex-1 ${t.done ? 'opacity-30 line-through' : ''}`}>{t.text}</span>
                                        <button onClick={() => setTodos(todos.filter(item => item.id !== t.id))} className="opacity-10"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'Memo' && (
                            <div className="fade-in space-y-6 pt-3 pb-8">
                                <div className={`p-3 rounded-2xl space-y-3 transition-colors ${newMemo.id ? 'bg-blue-50 border border-blue-100' : 'bg-[#F1F0EB]'}`}>
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="text-[10px] font-black uppercase opacity-40">{newMemo.id ? 'Edit Mode' : 'New Memo'}</span>
                                        {newMemo.id && (
                                            <button onClick={() => setNewMemo({content:'', tag:'', id: null})} className="text-[9px] font-bold text-blue-500 underline uppercase">Cancel Edit</button>
                                        )}
                                    </div>
                                    <div className="space-y-2">
                                        <input className="w-full bg-white px-3 py-2 rounded-lg text-xs font-bold" placeholder="#태그 (선택)" value={newMemo.tag} onChange={e=>setNewMemo({...newMemo, tag: e.target.value})} />
                                        {existingTags.length > 0 && (
                                            <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                                                {existingTags.map(tag => (
                                                    <button key={tag} onClick={() => setNewMemo({...newMemo, tag})} className="tag-chip btn-press">#{tag}</button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <textarea 
                                        ref={memoTextareaRef}
                                        className="w-full bg-transparent p-1 text-[13px] min-h-[60px] resize-none border-none memo-content memo-textarea-expandable" 
                                        placeholder="여기에 메모하세요..." 
                                        value={newMemo.content} 
                                        onChange={e=>setNewMemo({...newMemo, content: e.target.value})} 
                                    />
                                    <button onClick={saveMemo} className={`w-full text-white py-2.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-colors ${newMemo.id ? 'bg-blue-600 shadow-lg' : 'bg-[#1A1A1A]'}`}>
                                        {newMemo.id ? 'Update Memo' : 'Add Memo'}
                                    </button>
                                </div>

                                <div className="space-y-8">
                                    {Object.entries(groupedMemos.groups).map(([tagName, items]) => (
                                        <div key={tagName} className="space-y-3">
                                            <div className="flex items-center gap-2 px-1">
                                                <span className="text-[10px] font-black text-blue-500 uppercase tracking-widest">#{tagName}</span>
                                                <div className="h-[1px] flex-1 bg-blue-100" />
                                            </div>
                                            {items.map(m => (
                                                <MemoCard key={m.id} m={m} />
                                            ))}
                                        </div>
                                    ))}

                                    {groupedMemos.noTag.length > 0 && (
                                        <div className="space-y-3">
                                            {Object.keys(groupedMemos.groups).length > 0 && (
                                                <div className="flex items-center gap-2 px-1">
                                                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Others</span>
                                                    <div className="h-[1px] flex-1 bg-slate-100" />
                                                </div>
                                            )}
                                            {groupedMemos.noTag.map(m => (
                                                <MemoCard key={m.id} m={m} />
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'Search' && (
                            <div className="fade-in pt-3 pb-8">
                                <div className="relative mb-6">
                                    <input className="w-full bg-[#F1F0EB] rounded-2xl pl-12 pr-5 py-4 text-[15px] font-bold" placeholder="검색어를 입력하세요" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
                                    <i data-lucide="search" className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 opacity-20"></i>
                                </div>
                                <div className="space-y-4">
                                    {filteredResults().length > 0 ? (
                                        filteredResults().map((item, idx) => (
                                            <div key={idx} className="bg-white p-4 rounded-2xl border border-black/5 btn-press" onClick={() => {
                                                if(item.type === 'Journal') {
                                                    setCurrentDate(new Date(item.date));
                                                    setActiveTab('Journal');
                                                } else if (item.type === 'Memo') {
                                                    setHighlightedMemoId(item.id);
                                                    setExpandedMemoIds(prev => new Set(prev).add(item.id));
                                                    setActiveTab('Memo');
                                                } else if (item.type === 'Todo') {
                                                    setActiveTab('Todo');
                                                }
                                            }}>
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className={`text-[9px] font-black uppercase px-2 py-0.5 rounded ${item.type === 'Journal' ? 'bg-blue-50 text-blue-500' : item.type === 'Memo' ? 'bg-orange-50 text-orange-500' : 'bg-green-50 text-green-500'}`}>{item.type}</span>
                                                    {item.date && <span className="text-[9px] font-black opacity-20">{item.date}</span>}
                                                </div>
                                                <p className="text-[13px] opacity-70 line-clamp-2">{item.text}</p>
                                                {item.tag && <span className="text-[9px] font-bold text-blue-400 mt-2 block">#{item.tag}</span>}
                                            </div>
                                        ))
                                    ) : searchQuery && (
                                        <div className="text-center py-20 opacity-20">
                                            <i data-lucide="alert-circle" className="w-12 h-12 mx-auto mb-3"></i>
                                            <p className="text-xs font-black uppercase">No results found</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'Setting' && (
                            <div className="fade-in space-y-4 pt-3">
                                <div className="bg-white p-6 rounded-2xl border border-black/5 space-y-6">
                                    <div>
                                        <h3 className="text-[11px] font-black opacity-30 uppercase tracking-widest mb-4">Cloud & Backup</h3>
                                        <div className="space-y-3">
                                            <button onClick={() => handleExport(false)} className="w-full flex items-center justify-between px-5 py-4 bg-[#F1F0EB] text-[#1A1A1A] rounded-xl btn-press">
                                                <div className="text-left">
                                                    <div className="text-[11px] font-black uppercase">Export</div>
                                                    <div className="text-[9px] opacity-40 font-bold">전체 내용 내보내기</div>
                                                </div>
                                                <i data-lucide="download" className="w-5 h-5 opacity-40"></i>
                                            </button>
                                            <button onClick={() => fileInputRef.current.click()} className="w-full flex items-center justify-between px-5 py-4 border-2 border-[#1A1A1A] text-[#1A1A1A] rounded-xl btn-press">
                                                <div className="text-left">
                                                    <div className="text-[11px] font-black uppercase">Import</div>
                                                    <div className="text-[9px] opacity-40 font-bold">파일에서 불러오기</div>
                                                </div>
                                                <i data-lucide="upload" className="w-5 h-5 opacity-40"></i>
                                            </button>
                                            <input type="file" ref={fileInputRef} onChange={handleImport} accept=".json" className="hidden" />
                                        </div>
                                    </div>
                                    <div className="pt-2">
                                        <h3 className="text-[11px] font-black opacity-30 uppercase tracking-widest mb-4">App Info</h3>
                                        <div className="space-y-3 px-1">
                                            <div className="flex justify-between items-center">
                                                <span className="text-[10px] font-bold opacity-30">App Name</span>
                                                <span className="text-[10px] font-black text-[#1A1A1A] uppercase tracking-tighter">{APP_NAME}</span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className="text-[10px] font-bold opacity-30">Version</span>
                                                <span className="text-[10px] font-black text-[#1A1A1A] uppercase tracking-tighter">{APP_VERSION}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="px-4 flex justify-between items-center">
                        {[
                            { id: 'Journal', icon: 'book-open' }, 
                            { id: 'Todo', icon: 'check-square' }, 
                            { id: 'Memo', icon: 'feather' }, 
                            { id: 'Search', icon: 'search' },
                            { id: 'Setting', icon: 'settings' }
                        ].map(tab => (
                            <button key={tab.id} onClick={() => handleTabChange(tab.id)} className={`flex flex-col items-center flex-1 transition-all ${activeTab === tab.id ? 'opacity-100' : 'opacity-20'}`}>
                                <i data-lucide={tab.icon} className="w-[18px] h-[18px]" style={{strokeWidth: 2.5}}></i>
                                <span className="text-[9px] font-black mt-1.5 tracking-tighter uppercase">{tab.id}</span>
                            </button>
                        ))}
                    </nav>

                    {showCalendar && (
                        <div className="absolute inset-0 z-[1100] bg-[#FDFCF8] flex flex-col p-8 fade-in" onClick={() => setShowCalendar(false)}>
                            <div className="flex justify-between items-end mb-12" onClick={e=>e.stopPropagation()}>
                                <div>
                                    <span className="text-sm font-black opacity-30 block mb-1">{viewMonth.getFullYear()}</span>
                                    <span className="calendar-month-title">{viewMonth.getMonth()+1}월</span>
                                </div>
                                <div className="flex gap-3 mb-2">
                                    <button onClick={()=>setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1, 1))} className="p-3 bg-[#F1F0EB] rounded-2xl"><i data-lucide="chevron-left" className="w-6 h-6"></i></button>
                                    <button onClick={()=>setViewMonth(new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 1))} className="p-3 bg-[#F1F0EB] rounded-2xl"><i data-lucide="chevron-right" className="w-6 h-6"></i></button>
                                </div>
                            </div>
                            <div className="grid grid-cols-7 gap-y-4 text-center overflow-y-auto no-scrollbar" onClick={e=>e.stopPropagation()}>
                                {['S','M','T','W','T','F','S'].map((d,i)=><span key={i} className={`text-[11px] font-black opacity-20 ${i===0?'text-sun':i===6?'text-sat':''}`}>{d}</span>)}
                                {Array.from({length: new Date(viewMonth.getFullYear(), viewMonth.getMonth(), 1).getDay()}).map((_,i)=><div key={i}/>)}
                                {Array.from({length: new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 0).getDate()}).map((_,i)=>{
                                    const d = new Date(viewMonth.getFullYear(), viewMonth.getMonth(), i+1);
                                    const isSelected = d.toDateString() === currentDate.toDateString();
                                    const hDay = getHolidayName(d);
                                    const isSun = d.getDay() === 0 || hDay;
                                    const isSat = d.getDay() === 6;
                                    return (
                                        <button key={i} onClick={()=>{setCurrentDate(d);setShowCalendar(false)}} className={`relative flex flex-col items-center py-4 transition-all ${isSelected ? 'bg-[#1A1A1A] text-white rounded-2xl shadow-xl' : ''}`}>
                                            <span className={`text-[17px] font-black ${!isSelected && isSun ? 'text-sun' : !isSelected && isSat ? 'text-sat' : ''}`}>{i+1}</span>
                                            {journals[d.toDateString()] && !isSelected && <div className="calendar-dot" />}
                                            {hDay && <div className="text-[7px] font-black absolute bottom-1 truncate w-full px-1 text-center" style={{color: isSelected ? 'white' : 'var(--weekend-sun)'}}>{hDay}</div>}
                                        </button>
                                    )
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

